---
title: "IPL Moneyball"
output: html_notebook
author: amit_phadke
---
```{r}

library(ggplot2)
library(tidyverse)
library(gridExtra)
library(corrplot)
library(factoextra)
```
 
Before we start to analyze and explore our data, lets polish it by cleaning any null values, unhandled datatypes and raw unprocessed data. 


Here's our data at a glance.
  
```{r}
data <- read.csv("C:\\Users\\phadk\\Desktop\\Work\\projects\\t20\\moneyballing\\playoff.csv")
head(data)
```

Shape of our data

```{r}
dim(data)
```

Summary of the dataset.

```{r}
summary(data)
```

Check for null values

```{r}
colSums(is.na(data))
```

For every good analysis one of the most crucial thing is asking the right questions. With a sports analytics problem the most obvious question is:

What is the goal of a team?

The first thing that Beane and DePodesta wanted to know was how to they can make it to the playoff's. They argued that games at the playoffs are much more unpredictable and hence hard to quantify. In the case of IPL there are only 3 playoff matches each season hence that is much smaller dataset to analyze on. So the goal of the team leads us to the next question we want to ask is 

How does a team make it to the playoffs?

Easy answer. Win more games. Now the final question before we start analysis, 

How many wins does it take to make it to the playoffs?

To answer this question we will build a scatter plot if a team made it to playoff against number of wins.
```{r}
m <- ggplot(data, aes(x = Won,
                      y = Team,
                      color = factor(playoffs))) +
geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs")

m + geom_vline(aes(xintercept = 7.9), color = "black", linetype = "dashed", size=1) + xlab("Wins")
```

The following graph shows us that when number of is more than 8 those teams our possibly making it to the playoffs. 

Now our goal is much more clear. A team needs to win atleast 8 games out of 14 games to make it to the playoffs. Now we need ask how does a team win 7 games out of the 14 games in the league games.

Here DePodesta comes to our rescue. He argued that in baseball wins had a relationship with the difference between runs scored and runs allowed. Lets test if this is is the issue for IPL.  

```{r}
data$RD <- data$Runs.scored - data$Runs.allowed

ggplot(data, aes(x = RD,
                y = Won,
                color = factor(playoffs))) +
     geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs")
```
The following graph shows that teams that made the playoffs(marked in red), had higher run difference. This validates our assumption that runs diffrential is corelated with wins. Next we will use linear regression to predict number of wins based on run diffrential. 

```{r}
winsReg <- lm(Won ~ RD, data = data)
winsReg
```

To put this into readable terms our equation is:

Won  = 7.05556 + 0.01267(RD)

which also reads as:

RD = (Won - 7.05556)/0.01267

According to our previous analysis no of wins to get playoffs is 7. Thus our equation becomes:

RD = (7.9-7.05556)/0.01267
RD = 66.6487766
RD â‰ˆ 66

So it seems that a team has high chance of winning if the difference between runs is 66. Let validate that graphically.

```{r}
ggplot(data, aes(x = RD,
                 y = Won,
                 color = factor(playoffs))) +
     geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs") +
     geom_vline(aes(xintercept = 66), color = "black", linetype = "dashed", size=1)
```

Seems like we pull our threshold back to about 60

```{r}
ggplot(data, aes(x = RD,
                 y = Won,
                 color = factor(playoffs))) +
     geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs") +
     geom_vline(aes(xintercept = 58), color = "black", linetype = "dashed", size=1)
```

58+ seems like a good threshold to set our further analysis. Which brings to our fourth and final question :

How can a team score 58 more runs than they allow??


To answer this question Billy Beane and Paul DePodesta had useful baseball statistics like On-Base Percentage and Slugging percentage, Unfortunately IPL and T20 is a new gaming format. Hence we do not have a lot of statistics with cricket. 

So we will build our own statistics with whatever we have. Lets choose the best statistics we can use by doing a little bit of exploratory data analysis.  

```{r}
data1 <- data%>%select('Team','Season','Mat','Won',
                       'Runs.scored','deliveries.faced','SR','singles','doubles','triples','fours','sixers',
                       'Runs.allowed','deliveries.bowled','OPSR','singles_allowed','doubles_allowed','triples_allowed',
                       'fours_allowed','sixers_allowed','RD','playoffs')
```


```{r}
plot1 <- ggplot(data, aes(x =fours,
                 y = Runs.scored))+
geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs")

plot2 <- ggplot(data, aes(x =sixers,
                 y = Runs.scored))+
geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs")

plot3 <- ggplot(data, aes(x =singles,
                 y = Runs.scored))+
geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs")

plot4 <- ggplot(data, aes(x =doubles,
                 y = Runs.scored))+
geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs")

plot5 <- ggplot(data, aes(x =triples,
                 y = Runs.scored))+
geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs")

plot6 <- ggplot(data, aes(x =SR,
                 y = Runs.scored))+
geom_point() + scale_color_manual(values = c("#000000", "#FF2D00"), name = "Made Playoffs")
```

```{r}
grid.arrange(plot1, plot2, plot3,plot4,plot5,plot6, nrow=2, ncol=3)
```

Here we see that. Singles, Strike Rate and Fours have a good linearity with Number of runs scored. While sixers have somewhat of close linear relationship, Sixers are not attempted due to the high risk of losing wickets. Lets see the correlation of each of these metrics.

```{r}
corr_data <-data1 %>% select('Runs.scored','SR','singles','fours','sixers')
corr <- cor(corr_data)
corrplot(corr)
```

It seems that singles, sixers and strike_rate are almost of the same corelation with runs scored. Also sixers and strike-rate have a strong correlation with each other. Next step would be to do a PCA analysis to see which metric explains how much variance. 

```{r}
data_fe <- scale(corr_data)
data.pca = data_fe   #taking out only audio properties variables
pca <- prcomp(data.pca, scale=TRUE, center=TRUE)
summary(pca)
```
```{r}
pca$rotation
```

Looks like 4s and singles are seemed like good metrics to do regression on. We will also add Strike Rate into the mix and see what happens. 

```{r}
#prepping
data1$total <- data1$singles+data1$doubles+data1$triples+data$fours+data$sixers
data1$total_allowed <- data1$singles_allowed+data1$doubles_allowed+data1$triples_allowed+data$fours_allowed+data$sixers_allowed

#four and single percentage
data1$SP <- data1$singles/data1$total
data1$FP <- data1$fours/data1$total
data1$OSP <- data1$singles_allowed/data1$total_allowed
data1$OFP <- data1$fours_allowed/data1$total_allowed
head(data1)
```
#### Model Building

Now that we have everything in place lets build our model. We will use multiple linear regression and check the significance of each of our independant variables

```{r}
model <- data1 %>% select('Team','Season','Mat','Won','RD',
                          'Runs.scored','SR','singles','fours',
                          'Runs.allowed','OPSR','singles_allowed','fours_allowed',
                          'playoffs')
```

```{r}
RS_fit <- lm(Runs.scored ~ SR + singles + fours, data = model)
summary(RS_fit)
```



```{r}
RA_fit <- lm(Runs.allowed ~ OPSR + singles_allowed + fours_allowed, data = model)
summary(RA_fit)
```



Both our model have a good adjusted R-sqaured for us to proceed. The small caveat here is our sample data set is small with only 100 rows and we will require even more data to improve our precision and accuracy. Now that we have got all our significant values, let's see what contribution each of the variable gives to our dependant variable.  

Our equations for linear regressions for runs_allowed and runs_scored will be

Runs Scored = Intercept + 881.4146(SR) +  1.5791(singles) + 0.7214(fours)
Runs Allowed = Intercept + 808.6397(OPSR) + 1.7135(singles_allowed) + 0.8277(fours_allowed)

for validations we will take two teams. First we will take Chennai Super Kings who has been in every playoffs and second is Kings IX Punjab which has been playing for all season but only managed to get into playoffs twice. 


Chennai Super Kings
Runs Scored: 2191 
Strike Rate : 1.3302
Singles : 662
Fours : 752

Runs Allowed: 2275 
Opponent Strike Rate : 1.4060 
Opponent Singles : 686 
Opponent Fours : 780 


Runs Scored = -545.8271 + 881.4146(1.3302) +  1.5791(662) + 0.7214(752)
Runs Scored = 2214

Runs Allowed = -613.4578 + 881.4146(1.4060) +  1.5791(686) + 0.7214(780)
Runs Allowed = 2271 

 Kings IX PUnjab
Runs Scored: 2235 
Strike Rate : 1.400719856 
Singles : 661
Fours : 594

Runs Allowed: 2343
Opponent Strike Rate : 1.427787934
Opponent Singles : 620
Opponent Fours : 588

Runs Scored = -545.8271 + 881.4146(1.4007) +  1.5791(661) + 0.7214(594)
Runs Scored = 2161

Runs Allowed = -613.4578 + 881.4146(1.4277) +  1.5791(686) + 0.7214(588)
Runs Allowed = 2152


In 2020 Chennai Super Kings was 57+ runs, and Kings IX Punjab had runs diffrential of 9+ runs. We know in 2020 Chennai did make it to the playoffs while Punjab did not. Our baseline suggests a similar 58+ hence validating our baselines


#### Conclusion

When Chennai Super Kings reached the playoffs they had a strike rate of about 1.40 and scored 661 runs from singles and 594 runs from boundries. This could be a great tool for owner and coaches to make selections based on these facts. 

We will look for players who have these strong stats. 

Rather than buying players which have bigger batting average or star players, a team owner can buy player that is less costly and is highly effecient taking quick singles and score 4s rather than the risky 6s. 

A caveat for this analysis is the smaller dataset and almost to no research done on the topic.

 It will be interesting to look at IPL is a much informed and statistically significant way once we get more data and knowledge on this topic